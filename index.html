<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Capabilidade do Processo - Cp e Cpk</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; background-color: #f6f6f6; }
h1 { text-align: center; }
.step { margin: 15px 0; padding: 15px; background: #fff; border-radius: 10px; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
input[type="number"], input[type="text"], input[type="password"] { padding: 5px; margin: 5px 0; width: 120px; }
button { padding: 6px 12px; margin: 5px; border: none; border-radius: 6px; background-color: #007bff; color: white; cursor: pointer; }
button:disabled { background-color: #ccc; cursor: not-allowed; }
table { border-collapse: collapse; margin-top: 10px; width: 100%; }
th, td { border: 1px solid #999; padding: 5px; text-align: center; }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

<h1>Capabilidade do Processo ‚Äì Cp e Cpk</h1>

<div style="margin-bottom:20px;">
<label>Nome do estudante: <input type="text" id="studentName" placeholder="Digite seu nome"></label>
</div>

<div>
<label>Tamanho da amostra (n): <input type="number" id="sampleSize" min="2" max="15"></label>
<label>N√∫mero de amostras (k): <input type="number" id="numSamples" min="1"></label>
<button onclick="gerarTabela()">Gerar Tabela</button>
</div>

<div id="tableContainer" style="display:none;">
<h3>Preencha as medi√ß√µes, m√©dias e amplitudes</h3>
<table id="sampleTable"></table>
<button onclick="verificarMediasER()">Verificar M√©dias e Amplitudes</button>
<div id="feedback"></div>
</div>

<div class="step">
<h3>Passo 2 ‚Äì Limites e Cp/Cpk</h3>
<label>Limite inferior de especifica√ß√£o (LSL): <input type="number" id="lsl" step="0.001"></label><br>
<label>Limite superior de especifica√ß√£o (USL): <input type="number" id="usl" step="0.001"></label><br>
<label>Cp: <input type="number" id="cpAluno" step="0.001"></label><br>
<label>Cpk: <input type="number" id="cpkAluno" step="0.001"></label><br>
<button onclick="verificarCpCpk()">Verificar Cp e Cpk</button>
<div id="feedbackCpCpk"></div>
</div>

<div class="step">
<h3>M√≥dulo Professor (Senha)</h3>
<label>Senha: <input type="password" id="profPassword"></label>
<button onclick="ativarProfessor()">Ativar M√≥dulo Professor</button>
<div id="feedbackProf"></div>
<button onclick="gerarPDF()">Gerar Relat√≥rio PDF</button>
</div>

<script>
// Vari√°veis
let n=0, k=0;
let passosCorretos = [false,false,false]; // 0-M√©dias/R, 1-Cp, 2-Cpk
const d2_table = {2:1.128,3:1.693,4:2.059,5:2.326,6:2.534,7:2.704,8:2.847,9:2.970,10:3.078,11:3.173,12:3.258,13:3.336,14:3.407,15:3.472};

// Gera tabela
function gerarTabela(){
    n = parseInt(document.getElementById('sampleSize').value);
    k = parseInt(document.getElementById('numSamples').value);
    if(isNaN(n)||isNaN(k)||n<2||n>15||k<1){ alert("Digite valores v√°lidos!"); return; }

    const table = document.getElementById('sampleTable');
    table.innerHTML="";
    let thead="<tr><th>Amostra</th>";
    for(let j=1;j<=n;j++) thead+=`<th>X${j}</th>`;
    thead+="<th>XÃÑ</th><th>R</th></tr>";
    table.innerHTML += thead;

    for(let i=1;i<=k;i++){
        let row=`<tr><td>${i}</td>`;
        for(let j=1;j<=n;j++) row+=`<td><input type="number" step="0.001" id="cell_${i}_${j}"></td>`;
        row+=`<td><input type="number" step="0.001" id="media_${i}"></td>`;
        row+=`<td><input type="number" step="0.001" id="r_${i}"></td></tr>`;
        table.innerHTML+=row;
    }
    document.getElementById('tableContainer').style.display='block';
}

// Verifica m√©dias e amplitudes do aluno
function verificarMediasER(){
    let feedback="", todos=true;
    for(let i=1;i<=k;i++){
        let valores=[];
        for(let j=1;j<=n;j++) valores.push(parseFloat(document.getElementById(`cell_${i}_${j}`).value)||0);
        const mediaCorreta=valores.reduce((a,b)=>a+b,0)/n;
        const amplitudeCorreta=Math.max(...valores)-Math.min(...valores);
        const mediaAluno=parseFloat(document.getElementById(`media_${i}`).value)||0;
        const rAluno=parseFloat(document.getElementById(`r_${i}`).value)||0;
        if(Math.abs(mediaAluno-mediaCorreta)>0.001 || Math.abs(rAluno-amplitudeCorreta)>0.001){
            feedback+=`‚ùå Amostra ${i}: M√©dia ou R incorreto(a)<br>`;
            todos=false;
        } else feedback+=`‚úîÔ∏è Amostra ${i}: Correto<br>`;
    }
    if(todos) feedback="üéâ Todas as m√©dias e amplitudes est√£o corretas!";
    document.getElementById('feedback').innerHTML=feedback;
    passosCorretos[0]=todos;
}

// Verifica Cp e Cpk do aluno
function verificarCpCpk(){
    const lsl=parseFloat(document.getElementById('lsl').value);
    const usl=parseFloat(document.getElementById('usl').value);
    let medias=[], rValues=[];
    for(let i=1;i<=k;i++){
        medias.push(parseFloat(document.getElementById(`media_${i}`).value)||0);
        rValues.push(parseFloat(document.getElementById(`r_${i}`).value)||0);
    }
    const xBarGlobal=medias.reduce((a,b)=>a+b,0)/k;
    const rBarGlobal=rValues.reduce((a,b)=>a+b,0)/k;
    const sigma=rBarGlobal/d2_table[n];

    const cp=parseFloat(document.getElementById('cpAluno').value);
    const cpk=parseFloat(document.getElementById('cpkAluno').value);

    const cpCorreto=(isNaN(lsl)||isNaN(usl))?0:(usl-lsl)/(6*sigma);
    const cpkCorreto=(isNaN(lsl)||isNaN(usl))?0:Math.min((usl-xBarGlobal)/(3*sigma),(xBarGlobal-lsl)/(3*sigma));

    const tol=0.01;
    let feedback="";

    if(Math.abs(cp-cpCorreto)<=tol) passosCorretos[1]=true; else passosCorretos[1]=false;
    if(Math.abs(cpk-cpkCorreto)<=tol) passosCorretos[2]=true; else passosCorretos[2]=false;

    feedback+=`Cp esperado ‚âà ${cpCorreto.toFixed(3)}<br>`;
    feedback+=`Cpk esperado ‚âà ${cpkCorreto.toFixed(3)}<br>`;
    document.getElementById('feedbackCpCpk').innerHTML=feedback;
}

// M√≥dulo professor
function ativarProfessor(){
    const senha=document.getElementById('profPassword').value;
    if(senha!=='2806ANdr*'){ alert("Senha incorreta"); return; }
    let medias=[], rValues=[];
    for(let i=1;i<=k;i++){
        let valores=[];
        for(let j=1;j<=n;j++) valores.push(parseFloat(document.getElementById(`cell_${i}_${j}`).value)||0);
        const media=valores.reduce((a,b)=>a+b,0)/n;
        const amplitude=Math.max(...valores)-Math.min(...valores);
        medias.push(media);
        rValues.push(amplitude);
        document.getElementById(`media_${i}`).value=media.toFixed(3);
        document.getElementById(`r_${i}`).value=amplitude.toFixed(3);
    }
    const xBarGlobal=medias.reduce((a,b)=>a+b,0)/k;
    const rBarGlobal=rValues.reduce((a,b)=>a+b,0)/k;
    document.getElementById('feedbackProf').innerHTML=`‚úîÔ∏è M√≥dulo professor ativo<br>XÃÑ global = ${xBarGlobal.toFixed(3)}, RÃÑ = ${rBarGlobal.toFixed(3)}`;
    // Calcula Cp e Cpk somente se LSL e USL preenchidos
    const lsl=parseFloat(document.getElementById('lsl').value);
    const usl=parseFloat(document.getElementById('usl').value);
    const sigma=rBarGlobal/d2_table[n];
    if(!isNaN(lsl)&&!isNaN(usl)){
        const cp=(usl-lsl)/(6*sigma);
        const cpk=Math.min((usl-xBarGlobal)/(3*sigma),(xBarGlobal-lsl)/(3*sigma));
        document.getElementById('cpAluno').value=cp.toFixed(3);
        document.getElementById('cpkAluno').value=cpk.toFixed(3);
    }
}

// Gerar PDF
function gerarPDF(){
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    const name=document.getElementById('studentName').value||'Aluno';
    let passosOk=passosCorretos.filter(Boolean).length;
    const nota=Math.round((passosOk/3)*100);
    doc.text(`Relat√≥rio do Aluno: ${name}`,10,10);
    doc.text(`Passos corretos: ${passosOk}/3`,10,20);
    doc.text(`Nota: ${nota}`,10,30);
    doc.save(`Relatorio_${name}.pdf`);
}
</script>

</body>
</html>


